// Basic upgrade behavior
Unattended-Upgrade::DevRelease "false";
Unattended-Upgrade::AutoFixInterruptedDpkg "true";
Unattended-Upgrade::MinimalSteps "true";
Unattended-Upgrade::OnReboot "true";
Unattended-Upgrade::Automatic-Reboot "{{ configure_security_updates_auto_reboot | lower }}";
Unattended-Upgrade::Automatic-Reboot-Time "{{ configure_security_updates_auto_reboot_time }}";
Unattended-Upgrade::Automatic-Reboot-WithUsers "true";
Unattended-Upgrade::Remove-Unused-Dependencies "true";

// DISABLE built-in email notifications (we have better custom ones)
Unattended-Upgrade::Mail "";
Unattended-Upgrade::MailReport "never";
Unattended-Upgrade::MailOnlyOnError "false";

// Enhanced logging for our custom error handler
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::LogDir "/var/log/unattended-upgrades";

// Package selection for better stability
Unattended-Upgrade::Origins-Pattern {
    "origin=Ubuntu,archive=${distro_codename}-security";
    "origin=Ubuntu,archive=${distro_codename}-updates";
};

// Prevent problematic package updates
Unattended-Upgrade::Package-Blacklist {
    "linux-image-generic";
    "linux-image-virtual";
    "vim";
    "nano";
    "emacs";
};

// Enhanced download and retry settings
Unattended-Upgrade::Download-Upgradeable-Packages "true";
Unattended-Upgrade::Download-Upgradeable-Packages-Debdelta "true";
Unattended-Upgrade::Update-Package-Lists "true";
Unattended-Upgrade::CleanupDownloads "true";

// Retry mechanism for failed downloads
Unattended-Upgrade::RetryCount "3";
Unattended-Upgrade::RetryDelay "300";