---
- name: Disable password authentication
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: "^PasswordAuthentication"
    line: "PasswordAuthentication no"
    state: present
    backup: true
  notify: Restart ssh

- name: Disable root login
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: "^PermitRootLogin"
    line: "PermitRootLogin no"
    state: present
    backup: true
  notify: Restart ssh

- name: Disable empty passwords
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    state: present
    regexp: "^PermitEmptyPasswords"
    line: "PermitEmptyPasswords no"
    backup: true
  notify: Restart ssh

- name: Validate SSH configuration
  ansible.builtin.command: sshd -t
  changed_when: false
  failed_when: false
